<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Johan Hidding" />
  <title>All you’ll ever need is Markdown</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="style.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Dosis" rel="stylesheet">
</head>
<body>
<header id="title-block-header">
<h1 class="title">All you’ll ever need is Markdown</h1>
<p class="author">Johan Hidding</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#primer">Primer</a></li>
<li><a href="#pandoc-basics">Pandoc basics</a></li>
<li><a href="#pandoc-filters">Pandoc filters</a></li>
<li><a href="#lua-filters">Lua filters</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</nav>
<p>Markdown is widely used for writing up documents. It is supported by many blog engines, github readme, you name it. There are many varieties dialects and extensions to markdown. The quasi-standard is described on <a href="https://daringfireball.net/projects/markdown/">the Daring Fireball website</a>. One place where many flavours of markdown meet is in <a href="https://pandoc.org">Pandoc</a>. <a href="https://pandoc.org">Pandoc</a> can convert markdown to many different formats like HTML, LaTeX, PDF (through LaTeX), RTF, DOC, EPUB and even back to markdown of a different flavour. There are some little known features of (extended) markdown that make it very versatile and applicable to any application needing some form of rich content management, especially if you use <a href="https://pandoc.org">Pandoc</a>.</p>
<p>The take-away message is: you will never again have to write a document in LaTeX or HTML directly, not for writing notes, reports or papers, no power-point for presentations, no awkward wysiwig editor for web content; just use markdown.</p>
<p>You might ask “But Johan, how do I then …?”, shush! The answer is always going to be: <a href="https://pandoc.org"><strong>Pandoc</strong></a>.</p>
<h3 id="primer">Primer</h3>
<p>For those who have been living under the proverbial stone, markdown is a way of writing up rich content (i.e. text, document hierarchy, images, lists, quotes, etc.) in plain text using a human readable format. The format is aimed to mimick in plain text the formatted result:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb1-1" title="1">Level 1 Header</a>
<a class="sourceLine" id="cb1-2" title="2">==============</a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor </a>
<a class="sourceLine" id="cb1-5" title="5">incididunt ut labore et dolore magna aliqua.</a>
<a class="sourceLine" id="cb1-6" title="6"></a>
<a class="sourceLine" id="cb1-7" title="7">Level 2 Header</a>
<a class="sourceLine" id="cb1-8" title="8">--------------</a>
<a class="sourceLine" id="cb1-9" title="9"></a>
<a class="sourceLine" id="cb1-10" title="10">Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut </a>
<a class="sourceLine" id="cb1-11" title="11">aliquip ex ea commodo consequat.</a>
<a class="sourceLine" id="cb1-12" title="12"></a>
<a class="sourceLine" id="cb1-13" title="13">* <span class="fl">list item</span></a>
<a class="sourceLine" id="cb1-14" title="14"><span class="fl">* Another item</span></a>
<a class="sourceLine" id="cb1-15" title="15"></a>
<a class="sourceLine" id="cb1-16" title="16"><span class="fu">## Also a Level 2 Header</span></a>
<a class="sourceLine" id="cb1-17" title="17"></a>
<a class="sourceLine" id="cb1-18" title="18">Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu</a>
<a class="sourceLine" id="cb1-19" title="19">fugiat nulla pariatur.</a>
<a class="sourceLine" id="cb1-20" title="20"></a>
<a class="sourceLine" id="cb1-21" title="21">&gt;<span class="dt"> quote: Excepteur sint occaecat cupidatat non proident, sunt in culpa qui</span></a>
<a class="sourceLine" id="cb1-22" title="22"><span class="dt">&gt; officia deserunt mollit anim id est laborum.</span></a></code></pre></div>
<p>Read <a href="https://daringfireball.net/projects/markdown/syntax">Daring Fireball</a> for more syntax.</p>
<h4 id="flavours-and-extensions">Flavours and extensions</h4>
<p>There are many extensions to markdown, some of which are more widely used than others. I will highlight the most important ones for the purpose of my main message (expressing the awesomeness of Pandoc, if you missed it).</p>
<p>One of the most influencial flavour of markdown is the superset by Github, its major addition being that of delimited code blocks.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb2-1" title="1"><span class="bn">```javascript</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="bn">var factorial = n =&gt; (n &lt; 2) ? 1 : n * factorial(n - 1);</span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="bn">```</span></a></code></pre></div>
<h4 id="attributes">Attributes</h4>
<p>Nothing good ever comes from PHP, except for PHP Markdown, which adds attributes to markdown.</p>
<p>Any element in a markdown document can be adorned with (CSS style) attributes by appending them in curly braces: <code>{#id .class .class key=value}</code>. This also applies to code blocks: a line starting with <code>```python</code> is equivalent to <code>``` {.python}</code>.</p>
<h4 id="div-elements">DIV elements</h4>
<p>A <code>div</code> element can be added using three colons.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb3-1" title="1">::: {.warning}</a>
<a class="sourceLine" id="cb3-2" title="2">This is a warning!</a>
<a class="sourceLine" id="cb3-3" title="3">:::</a></code></pre></div>
<p>This can be used to write down any non-standard element. So how is this rendered? This is where pandoc comes in. Pandoc has support for filtering elements and creating relevant output.</p>
<h4 id="yaml-metadata">YAML metadata</h4>
<p>Information that is usually contained in a HTML <code>&lt;header&gt;</code> region can be included in the YAML metadata block. This is a block delimited by hyphens at the top of the document.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb4-1" title="1">---</a>
<a class="sourceLine" id="cb4-2" title="2">title: A theorem on right angled triangles</a>
<a class="sourceLine" id="cb4-3" title="3">author: Pythagoras of Samos</a>
<a class="sourceLine" id="cb4-4" title="4">date: ~520 BC, a hot summer night</a>
<a class="sourceLine" id="cb4-5" title="5">---</a></code></pre></div>
<p>This is also the place where you can configure options for Pandoc and its filters.</p>
<h4 id="equations">Equations</h4>
<p>Equations can be entered using the LaTeX DSL for equations. Use single <code>$</code> characters to delimit an inline equation and double <code>$$</code> to delimit a full width equation.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb5-1" title="1">Given a right angled triangle of sides $a$, $b$ and hypothenuse $c$, we may state that,</a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3">$$a^2 + b^2 = c^2.$$</a></code></pre></div>
<p>When converting to a LaTeX based output this will work trivially. For HTML it is probably best to use MathJax, enabled in Pandoc with the <code>--mathjax</code> and <code>--standalone</code> flags.</p>
<h3 id="pandoc-basics">Pandoc basics</h3>
<p>Pandoc reads and writes documents of many formats. It does so by converting to and from a native intermediate representation.</p>
<p>Create a document named <code>last-theorem.md</code> and enter the following:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb6-1" title="1">---</a>
<a class="sourceLine" id="cb6-2" title="2">title: Last theorem</a>
<a class="sourceLine" id="cb6-3" title="3">author: P. de Fermat</a>
<a class="sourceLine" id="cb6-4" title="4">---</a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6">For integer values of $a$, $b$, $c$ and $n &gt; 2$, the equation</a>
<a class="sourceLine" id="cb6-7" title="7"></a>
<a class="sourceLine" id="cb6-8" title="8">$$a^n + b^n \neq c^n,$$</a>
<a class="sourceLine" id="cb6-9" title="9"></a>
<a class="sourceLine" id="cb6-10" title="10">has no solution. I have a truly remarkable proof for this.</a></code></pre></div>
<p>We can see how Pandoc reads a document by running</p>
<pre class="shell"><code>pandoc -f markdown+yaml_metadata_block -t native -s last-theorem.md</code></pre>
<p>will give (slightly edited for readability)</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1"><span class="dt">Pandoc</span></a>
<a class="sourceLine" id="cb8-2" title="2">  (<span class="dt">Meta</span> {unMeta <span class="ot">=</span> fromList</a>
<a class="sourceLine" id="cb8-3" title="3">         [(<span class="st">&quot;author&quot;</span>, <span class="dt">MetaInlines</span> [<span class="dt">Str</span> <span class="st">&quot;P.&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;de&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;Fermat&quot;</span>])</a>
<a class="sourceLine" id="cb8-4" title="4">         ,(<span class="st">&quot;title&quot;</span>,  <span class="dt">MetaInlines</span> [<span class="dt">Str</span> <span class="st">&quot;Last&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;theorem&quot;</span>])]})</a>
<a class="sourceLine" id="cb8-5" title="5">  [<span class="dt">Para</span> [<span class="dt">Str</span> <span class="st">&quot;I&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;state&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;that,&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;for&quot;</span>,<span class="dt">Space</span></a>
<a class="sourceLine" id="cb8-6" title="6">        ,<span class="dt">Str</span> <span class="st">&quot;integer&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;values&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;of&quot;</span>,<span class="dt">Space</span></a>
<a class="sourceLine" id="cb8-7" title="7">        ,<span class="dt">Math</span> <span class="dt">InlineMath</span> <span class="st">&quot;a&quot;</span>,<span class="dt">Str</span> <span class="st">&quot;,&quot;</span>,<span class="dt">Space</span>,<span class="dt">Math</span> <span class="dt">InlineMath</span> <span class="st">&quot;b&quot;</span>,<span class="dt">Str</span> <span class="st">&quot;,&quot;</span>,<span class="dt">Space</span></a>
<a class="sourceLine" id="cb8-8" title="8">        ,<span class="dt">Math</span> <span class="dt">InlineMath</span> <span class="st">&quot;c&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;and&quot;</span>,<span class="dt">Space</span>,<span class="dt">Math</span> <span class="dt">InlineMath</span> <span class="st">&quot;n &gt; 2&quot;</span></a>
<a class="sourceLine" id="cb8-9" title="9">        ,<span class="dt">Str</span> <span class="st">&quot;,&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;the&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;equation&quot;</span>]</a>
<a class="sourceLine" id="cb8-10" title="10">  ,<span class="dt">Para</span> [<span class="dt">Math</span> <span class="dt">DisplayMath</span> <span class="st">&quot;a^n + b^n = c^n,&quot;</span>]</a>
<a class="sourceLine" id="cb8-11" title="11">  ,<span class="dt">Para</span> [<span class="dt">Str</span> <span class="st">&quot;has&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;no&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;solution.&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;I&quot;</span>,<span class="dt">Space</span></a>
<a class="sourceLine" id="cb8-12" title="12">        ,<span class="dt">Str</span> <span class="st">&quot;have&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;a&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;truly&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;elegant&quot;</span>,<span class="dt">Space</span></a>
<a class="sourceLine" id="cb8-13" title="13">        ,<span class="dt">Str</span> <span class="st">&quot;proof&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;for&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;this,&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;but&quot;</span>,<span class="dt">Space</span></a>
<a class="sourceLine" id="cb8-14" title="14">        ,<span class="dt">Str</span> <span class="st">&quot;this&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;is&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;not&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;the&quot;</span>,<span class="dt">Space</span></a>
<a class="sourceLine" id="cb8-15" title="15">        ,<span class="dt">Str</span> <span class="st">&quot;place&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;to&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;give&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;it.&quot;</span>]]</a></code></pre></div>
<p>Yes, this is Haskell syntax. It just means what you think it means. Using native output in Pandoc will be very useful if you start developing your own filters. For now it just serves to illustrates how Pandoc works. If you’re not a hacker, you’ll never have to look at this again 🤓👍.</p>
<p>Let’s create a PDF from this mathematics wizardry.</p>
<pre class="shell"><code>pandoc -f markdown+yaml_metadata_block -t latex -o last-theorem.pdf -s last-theorem.md</code></pre>
<p>Resulting in a nice PDF rendering:</p>
<figure>
<img src="last-theorem.png" alt="Typeset paper on a famous theorem" /><figcaption>Typeset paper on a famous theorem</figcaption>
</figure>
<h3 id="pandoc-filters">Pandoc filters</h3>
<p>There is a big problem with the above example. The equation is not numbered. Pandoc filters let you change the intermediate representation. Let’s try the <a href="https://github.com/tomduck/pandoc-eqnos"><code>pandoc-eqnos</code></a> filter. This filter is written in Python (using <code>pypandoc</code>); any language is possible.</p>
<pre class="shell"><code>pip install --user pandoc-eqnos</code></pre>
<p>We’ll need to change the <code>last-theorem.md</code> document a bit. Add an id to the equation.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb11-1" title="1">$$a^n + b^n = c^n,$$ {#eq:fermat}</a></code></pre></div>
<p>Also add a sentence to the end.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb12-1" title="1">The prove of inexistence of a solution for +@eq:fermat had eluded mathematicians for centuries.</a></code></pre></div>
<p>Now inspect the resulting native representation, add the <code>--filter pandoc-eqnos</code> arguments to the command line.</p>
<pre class="shell"><code>pandoc -f markdown+yaml_metadata_block --filter pandoc-eqnos -t native -s last-theorem.md</code></pre>
<p>Or create the updated PDF.</p>
<pre class="shell"><code>pandoc -f markdown+yaml_metadata_block -t latex --filter pandoc-eqnos -o last-theorem.pdf -s last-theorem.md</code></pre>
<figure>
<img src="last-theorem-2.png" alt="Typeset paper on a famous theorem with numbered equations." /><figcaption>Typeset paper on a famous theorem with numbered equations.</figcaption>
</figure>
<p>Pandoc command lines can grow out of hand rather quickly. It is advisable to manage your Pandoc settings in a Bash script or Make file, whatever you prefer.</p>
<h3 id="lua-filters">Lua filters</h3>
<p>Pandoc has built-in support for filters written in Lua. Filters written in Lua are generally faster than those written in Python or other external languages. Lua filters forego documents being passed to an external program via JSON, but rather work directly on the abstract syntax tree as it is represented in Pandoc itself.</p>
<p>Let’s add a feature. Add the following to our budding math paper:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode markdown"><code class="sourceCode markdown"><a class="sourceLine" id="cb15-1" title="1">::: {.warning}</a>
<a class="sourceLine" id="cb15-2" title="2">Modular forms and elliptic curves ahead!</a>
<a class="sourceLine" id="cb15-3" title="3">:::</a></code></pre></div>
<p>To parse this, Pandoc needs the extension <code>fenced_divs</code> enabled.</p>
<pre class="shell"><code>pandoc -f markdown+yaml_metadata_block+fenced_divs --filter pandoc-eqnos -t native -s last-theorem.md</code></pre>
<p>At the end of the output will be the expression:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb17-1" title="1"><span class="dt">Div</span> </a>
<a class="sourceLine" id="cb17-2" title="2">  (<span class="st">&quot;&quot;</span>,[<span class="st">&quot;warning&quot;</span>],[])</a>
<a class="sourceLine" id="cb17-3" title="3">  [<span class="dt">Para</span> [<span class="dt">Str</span> <span class="st">&quot;Modular&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;forms&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;and&quot;</span>,<span class="dt">Space</span></a>
<a class="sourceLine" id="cb17-4" title="4">        ,<span class="dt">Str</span> <span class="st">&quot;elliptic&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;curves&quot;</span>,<span class="dt">Space</span>,<span class="dt">Str</span> <span class="st">&quot;ahead!&quot;</span>]]</a></code></pre></div>
<p>If we generate HTML from this example, we can add the proper CSS to the <code>.warning</code> class to change the looks of the warning. If we look at the generated PDF however, there’s no change. Let’s change this. We define a filter that runs on all <code>div</code> elements</p>
<p><em>file: «warning-div.lua»=</em></p>
<div class="sourceCode" id="cb18"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">function</span> Div<span class="op">(</span>el<span class="op">)</span></a>
<a class="sourceLine" id="cb18-2" title="2">    <span class="op">&lt;&lt;</span>filter<span class="op">-</span>body<span class="op">&gt;&gt;</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="cf">end</span></a></code></pre></div>
<p>The filter checks if the <code>div</code> has class <code>warning</code>; if not, don’t change a thing.</p>
<p><em>«filter-body»=</em></p>
<div class="sourceCode" id="filter-body"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="filter-body-1" title="1"><span class="cf">if</span> el<span class="op">.</span>classes<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">==</span> <span class="st">&quot;warning&quot;</span> <span class="cf">then</span></a>
<a class="sourceLine" id="filter-body-2" title="2">    <span class="op">&lt;&lt;</span>generate<span class="op">-</span>latex<span class="op">&gt;&gt;</span></a>
<a class="sourceLine" id="filter-body-3" title="3"><span class="cf">end</span></a>
<a class="sourceLine" id="filter-body-4" title="4"><span class="cf">return</span> el</a></code></pre></div>
<p>We have to convert the contents of the <code>div</code> to a raw string, and create a <code>RawBlock</code> for LaTeX.</p>
<p><em>«generate-latex»=</em></p>
<div class="sourceCode" id="generate-latex"><pre class="sourceCode lua"><code class="sourceCode lua"><a class="sourceLine" id="generate-latex-1" title="1"><span class="fu">table.insert</span><span class="op">(</span>el<span class="op">.</span>content<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> pandoc<span class="op">.</span>RawBlock<span class="op">(</span><span class="st">&quot;latex&quot;</span><span class="op">,</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">begin{warning}&quot;</span><span class="op">))</span></a>
<a class="sourceLine" id="generate-latex-2" title="2"><span class="fu">table.insert</span><span class="op">(</span>el<span class="op">.</span>content<span class="op">,</span> pandoc<span class="op">.</span>RawBlock<span class="op">(</span><span class="st">&quot;latex&quot;</span><span class="op">,</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">end{warning}&quot;</span><span class="op">))</span>            </a></code></pre></div>
<p>Running Pandoc with <code>--lua-filter=warning-div.lua</code> now converts the <code>div</code> element to a raw LaTeX string</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode latex"><code class="sourceCode latex"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">\begin</span>{<span class="ex">warning</span>}Modular forms and elliptic curves ahead!<span class="kw">\end</span>{<span class="ex">warning</span>}</a></code></pre></div>
<p>This is not standard LaTeX, so we’ll need to define a macro</p>
<p><em>file: «warning.tex»=</em></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode latex"><code class="sourceCode latex"><a class="sourceLine" id="cb20-1" title="1"><span class="bu">\usepackage</span>{<span class="ex">tcolorbox</span>}</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="fu">\newenvironment</span>{warning}</a>
<a class="sourceLine" id="cb20-3" title="3">    {<span class="kw">\begin</span>{<span class="ex">tcolorbox</span>}[colbacktitle=red!50!white,</a>
<a class="sourceLine" id="cb20-4" title="4">                       title=Warning,coltitle=black,</a>
<a class="sourceLine" id="cb20-5" title="5">                       fonttitle=<span class="fu">\bfseries</span>]}</a>
<a class="sourceLine" id="cb20-6" title="6">    {<span class="kw">\end</span>{<span class="ex">tcolorbox</span>}}</a></code></pre></div>
<p>We can run Pandoc again to generate the PDF. The <code>-H</code> option can be used to add files to the preamble.</p>
<pre class="shell"><code>pandoc -f markdown+yaml_metadata_block+fenced_divs --filter pandoc-eqnos --lua-filter warning-div.lua -H warning.tex -t latex -o last-theorem.pdf -s last-theorem.md</code></pre>
<figure>
<img src="last-theorem-3.png" alt="Math paper with fair warning" /><figcaption>Math paper with fair warning</figcaption>
</figure>
<h3 id="conclusion">Conclusion</h3>
<p>Granted, to unlock the full power of markdown for the web, you’ll need to know some HTML and CSS, and to tweak PDF output to your impossibly high standards you need to grok LaTeX. All the more reason to create an ecosystem of scripts, themes and tutorials to ease the learning curve. Also, code editors should offer better support for more varieties of markdown. I don’t mean cluttering up the editing experience with more distracting tool-tips, snippets etc. Just this: correct and efficient highlighting and proper outline support.</p>
</body>
</html>
